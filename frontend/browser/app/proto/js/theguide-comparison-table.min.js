"use strict";angular.module("tgComparisonTable",["ingGlobal","ngSanitize","tgUtils","ngAnimate"]),angular.module("tgComparisonTable").config(["propertyServiceProvider",function(a){a.add("tgComparisonTable",{marked:"Gemarkeerd",selectProduct:"Maak uw keuze",columnAdded:"Tabel is gewijzigd naar {0} kolommen. {1} is toegevoegd",columnDeleted:"Tabel is gewijzigd naar {0} kolommen. {1} is verwijderd",columnChanged:"Kolom {0} is gewijzigd naar {1}"})}]),angular.module("tgComparisonTable").directive("tgComparisonTable",[function(){return{terminal:!0,restrict:"E",controller:["$scope","$element","$compile","$attrs","mqService","$timeout","tgUtils","propertyService","$window",function(a,b,c,d,e,f,g,h,i){function j(b){a.$evalAsync(function(){for(var c in r.viewData.objects)r.viewData.objects[c].selected=!1;for(var d in r.sourceData.objects)r.sourceData.objects[d].selected=!1;r.sourceData.objects[g.angularIndexOf(r.viewData.objects,r.viewData.objects[b])].selected=!0,r.viewData.objects[b].selected=!0,r.state.selected=!0,a.$emit(r.id+".objectSelected",r.viewData.objects[b])})}function k(){r.state.animationsEnabled=!0,f(function(){r.state.animationsEnabled=!1},600)}function l(b,c){a.$evalAsync(function(){r.state.isMobile=c.width>=e.mqSizes.xs?!1:!0,o()})}function m(){function c(a,b,c){var d={id:a,text:b,description:c};r.sourceData.properties.body.push(d)}function d(a,b,c,d){var e={id:String(g.createRandomId()),title:a,heading:b,marked:c,content:d};r.sourceData.objects.push(e)}var e=b.find("tg-comparison-caption")[0];e&&(r.sourceData.caption={},r.sourceData.caption.text=e.innerHTML,r.sourceData.caption.srOnly=a.$eval(e.getAttribute("sr-only"))),angular.forEach(b.find("tg-comparison-property"),function(a){c(a.getAttribute("property-id"),a.innerHTML,a.getAttribute("description"))}),angular.forEach(b.find("tg-comparison-object"),function(b){var c={},e=$(b).find("object-heading").length>0?$(b).find("object-heading").html():b.getAttribute("object-title");angular.forEach(angular.element(b).find("tg-comparison-field"),function(a){c[a.getAttribute("property-id")]=a.innerHTML}),d(b.getAttribute("object-title"),e,a.$eval(b.getAttribute("marked")),c)})}function n(){r.propertyColumnStyle={minWidth:r.config.propertyColumnMinWidth},r.objectColumnStyle={minWidth:r.config.objectColumnMinWidth}}function o(){var a=r.sourceData.objects.length,c=g.innerWidth(b.parent()),d=Math.floor(c/r.config.objectColumnMinWidth),e=a>=d?d:a,f=a*r.config.objectColumnMinWidth+r.config.propertyColumnMinWidth;2>e?(e=2,r.objectColumnStyle.minWidth=c/2):r.objectColumnStyle.minWidth=r.config.objectColumnMinWidth,p(r.state.columnSpan,e),r.state.isColGroup=f>c,r.state.columnSpan=e,r.state.showSelectBoxes=r.state.showSelectBoxes?!0:e<r.sourceData.objects.length}function p(b,c){var d,e=angular.copy(r.viewData);if(c<e.objects.length){if(d=e.objects[c].title,e.objects.splice(c,e.objects.length),!r.state.init){r.state.ariaLiveText=h.replaceVariables(r.config.texts.columnDeleted,[c,d]);var j=document.activeElement;f(function(){var a=j===document.activeElement?"Element met focus is ongewijzigd":"Element met focus is gewijzigd!!";angular.isDefined(i.Bootstrap)&&i.Bootstrap.trackEvent&&i.Bootstrap.trackEvent("Kolom in comparison table is verwijderd."+a)})}}else if(c>e.objects.length)for(var k=c-b,l=g.arrayDiff(r.sourceData.objects,r.viewData.objects),m=0;k>m;m++)e.objects.push(l[m]),d=l[m].title,r.state.ariaLiveText=h.replaceVariables(r.config.texts.columnAdded,[c,d]);r.state.init=!1,a.$evalAsync(function(){r.viewData=e})}function q(){if("init"!==r.state.columnSwitch){var b=r.state.columnSwitch.split("-"),c=b[0],d=b[1],e=angular.copy(r.sourceData.objects.filter(function(a){return a.id===d})[0]);a.$evalAsync(function(){r.viewData.objects[c]=e,r.state.ariaLiveText=h.replaceVariables(r.config.texts.columnChanged,[Number(c)+1,r.viewData.objects[c].title]),r.state.columnSwitch="init"})}}var r=this;this.id=b.attr("id")||"table-"+g.createRandomId(),this.enableAnimations=k,this.selectObject=j,this.config={},this.viewData={},this.sourceData={},this.state={},r.config={objectColumnMinWidth:Number(d.objectColumnMinWidth)||160,propertyColumnMinWidth:Number(d.propertyColumnMinWidth)||160,texts:angular.copy(h.properties("tgComparisonTable"))},r.state={animationsEnabled:!1,columnSwitch:"init",init:!0,isColGroup:!1,isMobile:!1,selected:!1,showSelectBoxes:!1},r.sourceData={properties:{head:{id:"columnTitles",text:""},body:[]},objects:[]},angular.isDefined(i.Bootstrap)&&i.Bootstrap.trackEvent&&i.Bootstrap.trackEvent("Comparison table wordt op scherm getoond"),d.markedText&&(r.config.texts.marked=d.markedText),d.selectProductText&&(r.config.texts.selectProduct=d.selectProductText),m(),n(),r.viewData=angular.copy(r.sourceData),o(),a.$on("mq-changed",l),a.$watch("table.state.columnSwitch",q),b.html(c(angular.element("<tg-comparison-table-template></tg-comparison-table-template>"))(a))}],controllerAs:"table"}}]),angular.module("tgComparisonTable").directive("tgComparisonTableTemplate",[function(){return{restrict:"E",template:'<div id="{{table.id}}-update" aria-live="assertive" aria-atomic="false" aria-relevant="additions"><div class="sr-only" tg-sr-trigger="table.state.ariaLiveText"></div></div><form><div aria-atomic="false" aria-live="off" ng-class="{\'l-ml-n1 l-mr-n1\': table.state.isMobile}"><table class="table table-b h-bor-b-0"><caption ng-class="{ \'l-pl-1 l-pr-1\' : table.state.isMobile , \'sr-only\' : table.viewData.caption.srOnly}" class="heading-b-xl" ng-bind-html="table.viewData.caption.text"></caption><thead><tr class="h-bor-b-1"><th ng-if="!table.state.isColGroup" class="l-w-1" ng-style="table.propertyColumnStyle"></th><th ng-class="{\'animate-fade\': table.state.animationsEnabled}" class="duration-in-slow duration-out-none l-w-1" id="{{table.id}}-object-{{$index}}" ng-repeat="object in table.viewData.objects" ng-style="table.objectColumnStyle"><span ng-if="object.marked" class="sr-only">{{table.config.texts.marked}}</span><div tg-compile="object.heading"></div></th></tr></thead><tbody><tr ng-if="table.state.showSelectBoxes"><th ng-if="!table.state.isColGroup"></th><td headers="{{table.id}}-object-{{$index}}" ng-init="colIndex = $index" ng-repeat="object in table.viewData.objects" ng-class="{\'animate-fade\':table.state.animationsEnabled, \'h-bg-b \': (object.marked && !table.state.selected) || object.selected }" class="duration-in-slow duration-out-none"><select name="sel-{{$index}}" class="form-control" aria-labelledby="{{table.id}}-object-{{$index}} track by $index" ng-model="table.state.columnSwitch" ng-change="table.enableAnimations()"><option value="init" disabled class="ng-hide">{{table.config.texts.selectProduct}}</option><option ng-repeat="object in table.sourceData.objects" value="{{colIndex}}-{{object.id}}">{{object.title}}</option></select></td></tr><tr ng-if="table.state.isColGroup && rowHeader.text" ng-repeat-start="rowHeader in table.viewData.properties.body" class="thead-sub"><td ng-class="{\'animate-fade\':table.state.animationsEnabled}" class="duration-in-slow duration-out-none" colspan="{{table.state.columnSpan}}" id="{{table.id}}-property-{{rowIndex}}" tg-compile="rowHeader.text"></td></tr><tr ng-init="rowIndex = $index" ng-repeat-end><th ng-if="!table.state.isColGroup && rowHeader.text" id="{{table.id}}-property-{{rowIndex}}" tg-compile="rowHeader.text"></th><td ng-if="!table.state.isColGroup && !rowHeader.text"></td><td ng-class="{\'animate-fade\':table.state.animationsEnabled, \'h-bg-b\': (object.marked && !table.state.selected) || object.selected}" class="duration-in-slow duration-out-none" headers="{{(rowHeader.text ? table.id + \'-property-\' + rowIndex + \' \' : \'\') + table.id + \'-object-\' + $index }}" ng-repeat="object in table.viewData.objects" tg-compile="object.content[rowHeader.id]"></td></tr></tbody></table></div></form>'}}]),angular.module("tgComparisonTable").directive("tgCompile",["$compile",function(a){return{restrict:"A",link:function(b,c,d){var e=b.$eval(d.compileScope);b.$watch(function(){return b.$eval(d.tgCompile)},function(d){c.html(d),a(c.contents())(e||b)})}}}]),angular.module("tgComparisonTable").directive("tgSelectButton",["tgUtils",function(a){return{restrict:"A",require:"^^tgComparisonTable",link:function(b,c,d,e){c.on("click",function(){var b=a.parent(c,"th, td").getAttribute("headers"),d=b.split("-");e.selectObject(d[d.length-1])})}}}]),angular.module("tgComparisonTable").directive("tgSrTrigger",[function(){return{restrict:"A",link:function(a,b,c){function d(a,c){a!==c&&(b.html(""),b.html(angular.element("<div>"+a+"</div>")))}a.$watch(function(){return a.$eval(c.tgSrTrigger)},d)}}}]),angular.module("tgComparisonTable").directive("tgTableInteractiveElement",["tgUtils",function(a){return{restrict:"A",require:"^^tgComparisonTable",link:function(b,c,d){if(d.id||c.attr("id","tableInteractiveElement-"+a.createRandomId()),!d.ariaLabelledby){var e=a.parent(c,"th, td"),f=e.getAttribute("headers");c.attr("aria-labelledby",f+" "+c.attr("id"))}}}}]);